# ๐๏ธ Ingenium - System Architecture

## ๐ Application Flow Diagram

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     ENTITY SELECTION SCREEN                      โ
โ                          (Home Page)                             โ
โ   โโโโโโโโโโโโ      โโโโโโโโโโโโ      โโโโโโโโโโโโโโโโโโโโ     โ
โ   โ   USER   โ      โ HOSPITAL โ      โ    GOVERNMENT    โ     โ
โ   โ    ๐ค    โ      โ    ๐ฅ    โ      โ       ๐๏ธ         โ     โ
โ   โโโโโโโโโโโโ      โโโโโโโโโโโโ      โโโโโโโโโโโโโโโโโโโโ     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ                    โ                       โ
         โ                    โ                       โ
         โผ                    โผ                       โผ
โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ   โโโโโโโโโโโโโโโโโโโโ
โ  USER LOGIN/    โ  โ HOSPITAL LOGIN/ โ   โ GOVERNMENT LOGIN โ
โ   REGISTER      โ  โ    REGISTER     โ   โ                  โ
โ  (OTP-Based)    โ  โ (Email/Password)โ   โ (Officer ID)     โ
โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ   โโโโโโโโโโโโโโโโโโโโ
         โ                    โ                       โ
         โ                    โ                       โ
         โผ                    โผ                       โผ
โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ   โโโโโโโโโโโโโโโโโโโโ
โ USER DASHBOARD  โ  โ    HOSPITAL     โ   โ   GOVERNMENT     โ
โ                 โ  โ    DASHBOARD    โ   โ    DASHBOARD     โ
โ โโโโโโโโโโโโโโโ โ  โ                 โ   โ                  โ
โ โ  ๐ฉบ MEDICAL โ โ  โ View Patients   โ   โ Review Farmer    โ
โ โ  SERVICES   โ โ  โ Access Data     โ   โ  Applications    โ
โ โโโโโโโโโโโโโโโ โ  โ Upload Records  โ   โ                  โ
โ                 โ  โ Create Bills    โ   โ Update Status    โ
โ โโโโโโโโโโโโโโโ โ  โโโโโโโโโโโโโโโโโโโ   โ Add Replies      โ
โ โ  ๐พ FARMER  โ โ                         โโโโโโโโโโโโโโโโโโโโ
โ โ  SERVICES   โ โ
โ โโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโ
    โ        โ
    โ        โ
    โผ        โผ
 MEDICAL  FARMER
 MODULE   MODULE
```

## ๐ฉบ Medical Module Flow (PRIMARY MODULE)

```
USER DASHBOARD
      โ
      โ Select "Medical Services"
      โผ
โโโโโโโโโโโโโโโโโโโโโโโโ
โ Check Medical        โ
โ Account Status       โ
โ GET /medical/        โ
โ account/status       โ
โโโโโโโโโโโโโโโโโโโโโโโโ
      โ
      โโโโโโโโ Account EXISTS โโโโโโโ
      โ                             โ
      โ                             โผ
      โ                    โโโโโโโโโโโโโโโโโโโ
      โ                    โ MEDICAL LOGIN   โ
      โ                    โ POST /medical/  โ
      โ                    โ      login      โ
      โ                    โโโโโโโโโโโโโโโโโโโ
      โ                             โ
Account NOT EXISTS                  โ
      โ                             โ
      โผ                             โ
โโโโโโโโโโโโโโโโโโโโโโโโ           โ
โ CREATE MEDICAL       โ           โ
โ    ACCOUNT           โ           โ
โ                      โ           โ
โ 1. Enter Email &     โ           โ
โ    Password          โ           โ
โ POST /medical/       โ           โ
โ  account/initiate    โ           โ
โ                      โ           โ
โ 2. Verify OTP        โ           โ
โ POST /medical/       โ           โ
โ  account/create      โ           โ
โโโโโโโโโโโโโโโโโโโโโโโโ           โ
      โ                             โ
      โ                             โ
      โโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโ
                 โ
                 โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ     MEDICAL DASHBOARD          โ
        โ                                โ
        โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
        โ  โ ๐ค Personal Medical     โ โ
        โ  โ    Profile              โ โ
        โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
        โ                                โ
        โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
        โ  โ ๐ฅ Hospital Access      โ โ
        โ  โ    Management           โ โ
        โ  โ                          โ โ
        โ  โ  โข Grant Access          โ โ
        โ  โ  โข 8 Permission Types:   โ โ
        โ  โ    - Profile             โ โ
        โ  โ    - Records             โ โ
        โ  โ    - Bills               โ โ
        โ  โ    - Insurance           โ โ
        โ  โ    - Appointments        โ โ
        โ  โ    - Prescriptions       โ โ
        โ  โ    - Lab Results         โ โ
        โ  โ    - Allergies           โ โ
        โ  โ  โข Set Duration          โ โ
        โ  โ  โข Revoke Access         โ โ
        โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
        โ                                โ
        โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
        โ  โ ๐ Medical Records &    โ โ
        โ  โ    Documents            โ โ
        โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
        โ                                โ
        โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
        โ  โ ๐ฐ Bills & Insurance    โ โ
        โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
        โ                                โ
        โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
        โ  โ ๐ Privacy & Audit Logs โ โ
        โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ฅ Hospital Access Flow

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              PATIENT (Medical User)                  โ
โ                                                      โ
โ  Grants Hospital Access with:                       โ
โ  โข Hospital ID (HFR)                                 โ
โ  โข 8 Permission Types with Read/Upload:             โ
โ    - Profile (read-only)                             โ
โ    - Records (read/upload)                           โ
โ    - Bills (read/upload)                             โ
โ    - Insurance (read/upload)                         โ
โ    - Appointments (read-only)                        โ
โ    - Prescriptions (read/upload)                     โ
โ    - Lab Results (read/upload)                       โ
โ    - Allergies (read-only)                           โ
โ  โข Duration: 7/30/90 days                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โ POST /medical/access/grant
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              DATABASE: hospital_access               โ
โ                                                      โ
โ  โข Creates access record                            โ
โ  โข Sets expiry date                                  โ
โ  โข Creates audit log entry                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    HOSPITAL                          โ
โ                                                      โ
โ  1. Login to hospital dashboard                     โ
โ  2. View active patients (GET /hospital/patients)   โ
โ  3. Select patient                                   โ
โ  4. View details (GET /hospital/patient/:id)        โ
โ     โข System checks access permissions              โ
โ     โข Filters data based on scope                   โ
โ     โข Creates audit log entry                       โ
โ  5. Upload records (if permitted)                   โ
โ     โข POST /hospital/records/upload                 โ
โ  6. Create bills                                     โ
โ     โข POST /hospital/bills/create                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              AUDIT LOG (Immutable)                   โ
โ                                                      โ
โ  โข access_granted                                    โ
โ  โข data_viewed                                       โ
โ  โข data_uploaded                                     โ
โ  โข Timestamp                                         โ
โ  โข IP Address                                        โ
โ  โข Details (JSON)                                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐พ Farmer Module Flow (SECONDARY MODULE)

```
USER DASHBOARD
      โ
      โ Select "Farmer Services"
      โผ
โโโโโโโโโโโโโโโโโโโโโโโโ
โ Check Farmer         โ
โ Account Status       โ
โ GET /farmer/         โ
โ account/status       โ
โโโโโโโโโโโโโโโโโโโโโโโโ
      โ
      โโโโ EXISTS โโโโโโโโโโโโโโ
      โ                         โ
  NOT EXISTS                    โ
      โ                         โผ
      โผ                  โโโโโโโโโโโโโโโโ
โโโโโโโโโโโโโโโโโโโโโโโโโ FARMER LOGIN โ
โ  FARMER KYC          โโ              โ
โ  REGISTRATION        โโ Login with:  โ
โ                      โโ โข Email      โ
โ 4-Step Process:      โโ โข KYC ID     โ
โ                      โโโโโโโโโโโโโโโโโ
โ Step 1: Email        โ      โ
โ   โข Email Address    โ      โ
โ     (used as login)  โ      โผ
โ                      โโโโโโโโโโโโโโโโโโโโโ
โ Step 2: Personal     โโ FARMER DASHBOARD โ
โ   โข Full Name        โโ                  โ
โ   โข Aadhaar          โโ โข View Profile   โ
โ   โข Mobile           โโ โข KYC ID Display โ
โ   โข Address          โโ โข Applications   โ
โ   โข State            โโโโโโโโโโโโโโโโโโโโโ
โ                      โ      โ
โ Step 3: Agricultural โ      โผ
โ   โข Land Ownership   โโโโโโโโโโโโโโโโโโโโโ
โ   โข Land Area        โโ Submit/Track     โ
โ   โข Village/Taluka   โโ Applications:    โ
โ   โข District/Pincode โโ                  โ
โ   โข Crop Type        โโ โข Subsidies      โ
โ   โข Irrigation       โโ โข Loans          โ
โ   โข Storage          โโ โข Schemes        โ
โ                      โโ โข Certification  โ
โ Step 4: Financial    โโโโโโโโโโโโโโโโโโโโโ
โ   โข Bank Account     โ      โ
โ   โข IFSC Code        โ      โผ
โ   โข Bank Name        โโโโโโโโโโโโโโโโโโโโโ
โ   โข KCC Number       โโ Government       โ
โ   โข Existing ID      โโ Reviews          โ
โ                      โโโโโโโโโโโโโโโโโโโโโ
โ POST /farmer/        โ
โ  kyc-register        โ
โ                      โ
โ Returns:             โ
โ โข KYC ID (Password)  โ
โ   Format: FRM-STATE- โ
โ   YEAR-XXXXXX        โ
โโโโโโโโโโโโโโโโโโโโโโโโ
      โ
      โ Auto-generates KYC ID
      โ Email = Username
      โ KYC ID = Password
      โ
      โโโโโโโโโโโโโโโโโโโโโโโ

Login Credentials:
  Username: Email Address
  Password: KYC ID (e.g., FRM-MH-2026-A1B2C3)
```

## ๐ Security Architecture

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  CLIENT REQUEST                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              AUTHENTICATION LAYER                    โ
โ                                                      โ
โ  1. Extract JWT from Authorization header           โ
โ  2. Verify token signature                          โ
โ  3. Check token expiration                          โ
โ  4. Decode user information                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              AUTHORIZATION LAYER                     โ
โ                                                      โ
โ  1. Check user role/type                            โ
โ  2. Verify route permissions                        โ
โ  3. Check resource ownership                        โ
โ  4. Validate access scope (for hospitals)           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                BUSINESS LOGIC                        โ
โ                                                      โ
โ  Execute requested operation                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  AUDIT LOGGING                       โ
โ                                                      โ
โ  Record all access events (immutable)               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ Database Schema Relationships

```
โโโโโโโโโโโโ          โโโโโโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโ
โ  users   โโโ1โโโ1โโโโ medical_account โโโโ1โโ*โโโmedical_      โ
โโโโโโโโโโโโ          โโโโโโโโโโโโโโโโโโโ         โ folders      โ
     โ                        โ                    โโโโโโโโโโโโโโโโ
     โ                        โ 1                         โ 1
     โ                        โ                           โ
     โ                        โ *                         โ *
     โ                 โโโโโโโโโโโโโโโโ           โโโโโโโโโโโโโโโโ
     โ                 โhospital_     โ           โmedical_files โ
     โ                 โ  access      โ           โโโโโโโโโโโโโโโโ
     โ                 โโโโโโโโโโโโโโโโ
     โ                        โ
     โ                        โ *
     โ                        โ
     โ                        โ 1
     โ                 โโโโโโโโโโโโโโโโ
     โ                 โ  hospitals   โ
     โ                 โโโโโโโโโโโโโโโโ
     โ
     โ 1 (optional)
     โ
     โ *
โโโโโโโโโโโโโโโโ
โfarmer_accountโ
โ              โ
โ Fields:      โ
โ โข kyc_id     โ
โ โข username   โ
โ   (email)    โ
โ โข password   โ
โ   (KYC ID)   โ
โ โข aadhaar    โ
โ โข mobile     โ
โ โข email      โ
โ โข state      โ
โ โข land_area  โ
โ โข bank info  โ
โโโโโโโโโโโโโโโโ
     โ 1
     โ
     โ *
โโโโโโโโโโโโโโโโ
โ  farmer_     โ
โ applications โ
โโโโโโโโโโโโโโโโ
     โ *
     โ
     โ 1
โโโโโโโโโโโโโโโโ
โ government_  โ
โ    users     โ
โโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโ
โ  audit_logs  โ
โ  (immutable) โ
โ              โ
โ Logs all:    โ
โ โข Medical    โ
โ   access     โ
โ โข Hospital   โ
โ   actions    โ
โ โข Data views โ
โ โข Uploads    โ
โโโโโโโโโโโโโโโโ
```

## ๐ฏ Data Privacy Model

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              USER'S MEDICAL DATA                     โ
โ                                                      โ
โ  Default State: PRIVATE                             โ
โ  Access: User Only                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โ User Action:
                         โ Grant Access
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ           GRANULAR ACCESS CONTROL                    โ
โ                                                      โ
โ  8 Permission Types:                                 โ
โ    โ Profile        (read-only)                     โ
โ    โ Records        (read/upload)                   โ
โ    โ Bills          (read/upload)                   โ
โ    โ Insurance      (read/upload)                   โ
โ    โ Appointments   (read-only)                     โ
โ    โ Prescriptions  (read/upload)                   โ
โ    โ Lab Results    (read/upload)                   โ
โ    โ Allergies      (read-only)                     โ
โ                                                      โ
โ  Duration: 7/30/90 days (auto-expire)               โ
โ                                                      โ
โ  Hospital: City General Hospital (HFR:12345)        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โ Access Created
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ           HOSPITAL CAN NOW ACCESS:                   โ
โ                                                      โ
โ  โ Profile Data (read only)                        โ
โ  โ Medical Records (read + upload)                 โ
โ  โ Bills (read + upload)                           โ
โ  โ Insurance (no access)                           โ
โ  โ Appointments (read only)                        โ
โ  โ Prescriptions (no access)                       โ
โ  โ Lab Results (read + upload)                     โ
โ  โ Allergies (no access)                           โ
โ                                                      โ
โ  Valid Until: Selected duration from grant date     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โ All actions logged
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              IMMUTABLE AUDIT TRAIL                   โ
โ                                                      โ
โ  2026-01-17 10:30 - access_granted                  โ
โ  2026-01-17 11:45 - data_viewed (profile)           โ
โ  2026-01-17 14:20 - data_uploaded (lab_report)      โ
โ  2026-01-18 09:15 - data_viewed (records)           โ
โ  2026-01-20 16:00 - access_revoked (user action)    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ Authentication Models

### User Authentication
- **Method:** OTP-based (email verification)
- **Storage:** JWT token with user role
- **Session:** Persistent until logout

### Medical Account Authentication  
- **Method:** Email + Password + OTP verification
- **Creation:** Two-step process (initiate โ verify OTP โ create)
- **Storage:** JWT token with medical_user role
- **Separate Session:** Independent from user session

### Farmer Authentication
- **Registration:** 4-step KYC process
  - Step 1: Email (becomes username)
  - Step 2: Personal details (name, aadhaar, mobile, address)
  - Step 3: Agricultural details (land, crops, irrigation)
  - Step 4: Financial details (bank account, IFSC, KCC)
- **Auto-generated Credentials:**
  - Username: Email address provided
  - Password: KYC ID (Format: FRM-STATE-YEAR-XXXXXX)
  - Example: FRM-MH-2026-A1B2C3
- **Login Method:** Email + KYC ID
- **Storage:** JWT token with farmer role
- **KYC ID Storage:** Plain text (not hashed) for direct verification
- **Separate Session:** Independent from user session

### Hospital Authentication
- **Registration:** Facility ID (HFR) + Email + Password
- **Login:** Email + Password
- **Storage:** JWT token with hospital role
- **Access Control:** Can only view patients who granted access

### Government Authentication
- **Login:** Officer ID + Password
- **Departments:** Health, Agriculture, Revenue, Welfare
- **Roles:** Officer, Senior Officer, Admin

---

**This architecture ensures:**
- โ Complete user control over data
- โ Granular permission management (8 permission types)
- โ Time-bound access (7/30/90 days)
- โ Complete transparency (audit logs)
- โ Immutable record keeping
- โ Privacy-first design
- โ Separate authentication contexts for different roles
- โ Farmer KYC with auto-generated secure credentials
- โ Email-based login with KYC ID as password for farmers
