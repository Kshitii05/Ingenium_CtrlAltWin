# ๐๏ธ Ingenium - System Architecture

## ๐ Application Flow Diagram

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     ENTITY SELECTION SCREEN                      โ
โ                                                                   โ
โ   โโโโโโโโโโโโ      โโโโโโโโโโโโ      โโโโโโโโโโโโโโโโโโโโ     โ
โ   โ   USER   โ      โ HOSPITAL โ      โ    GOVERNMENT    โ     โ
โ   โ    ๐ค    โ      โ    ๐ฅ    โ      โ       ๐๏ธ         โ     โ
โ   โโโโโโโโโโโโ      โโโโโโโโโโโโ      โโโโโโโโโโโโโโโโโโโโ     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โ                    โ                       โ
         โ                    โ                       โ
         โผ                    โผ                       โผ
โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ   โโโโโโโโโโโโโโโโโโโโ
โ  USER LOGIN/    โ  โ HOSPITAL LOGIN/ โ   โ GOVERNMENT LOGIN โ
โ   REGISTER      โ  โ    REGISTER     โ   โ                  โ
โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ   โโโโโโโโโโโโโโโโโโโโ
         โ                    โ                       โ
         โ                    โ                       โ
         โผ                    โผ                       โผ
โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ   โโโโโโโโโโโโโโโโโโโโ
โ USER DASHBOARD  โ  โ    HOSPITAL     โ   โ   GOVERNMENT     โ
โ                 โ  โ    DASHBOARD    โ   โ    DASHBOARD     โ
โ โโโโโโโโโโโโโโโ โ  โ                 โ   โ                  โ
โ โ  ๐ฉบ MEDICAL โ โ  โ View Patients   โ   โ Review Farmer    โ
โ โ  SERVICES   โ โ  โ Access Data     โ   โ  Applications    โ
โ โโโโโโโโโโโโโโโ โ  โ Upload Records  โ   โ                  โ
โ                 โ  โ Create Bills    โ   โ Update Status    โ
โ โโโโโโโโโโโโโโโ โ  โโโโโโโโโโโโโโโโโโโ   โ Add Replies      โ
โ โ  ๐พ FARMER  โ โ                         โโโโโโโโโโโโโโโโโโโโ
โ โ  SERVICES   โ โ
โ โโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโ
    โ        โ
    โ        โ
    โผ        โผ
```

## ๐ฉบ Medical Module Flow (PRIMARY MODULE)

```
USER DASHBOARD
      โ
      โ Select "Medical Services"
      โผ
โโโโโโโโโโโโโโโโโโโโโโโโ
โ Check Medical        โ
โ Account Status       โ
โ GET /medical/        โ
โ account/status       โ
โโโโโโโโโโโโโโโโโโโโโโโโ
      โ
      โโโโโโโโ Account EXISTS โโโโโโโ
      โ                             โ
      โ                             โผ
      โ                    โโโโโโโโโโโโโโโโโโโ
      โ                    โ MEDICAL LOGIN   โ
      โ                    โ POST /medical/  โ
      โ                    โ      login      โ
      โ                    โโโโโโโโโโโโโโโโโโโ
      โ                             โ
Account NOT EXISTS                  โ
      โ                             โ
      โผ                             โ
โโโโโโโโโโโโโโโโโโโโโโโโ           โ
โ CREATE MEDICAL       โ           โ
โ    ACCOUNT           โ           โ
โ                      โ           โ
โ 1. Enter Email &     โ           โ
โ    Password          โ           โ
โ POST /medical/       โ           โ
โ  account/initiate    โ           โ
โ                      โ           โ
โ 2. Verify OTP        โ           โ
โ POST /medical/       โ           โ
โ  account/create      โ           โ
โโโโโโโโโโโโโโโโโโโโโโโโ           โ
      โ                             โ
      โ                             โ
      โโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโ
                 โ
                 โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ     MEDICAL DASHBOARD          โ
        โ                                โ
        โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
        โ  โ ๐ค Personal Medical     โ โ
        โ  โ    Profile              โ โ
        โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
        โ                                โ
        โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
        โ  โ ๐ฅ Hospital Access      โ โ
        โ  โ    Management           โ โ
        โ  โ                          โ โ
        โ  โ  โข Grant Access          โ โ
        โ  โ  โข Set Scope             โ โ
        โ  โ  โข Set Permissions       โ โ
        โ  โ  โข Set Duration          โ โ
        โ  โ  โข Revoke Access         โ โ
        โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
        โ                                โ
        โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
        โ  โ ๐ Medical Records &    โ โ
        โ  โ    Documents            โ โ
        โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
        โ                                โ
        โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
        โ  โ ๐ฐ Bills & Insurance    โ โ
        โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
        โ                                โ
        โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
        โ  โ ๐ Privacy & Audit Logs โ โ
        โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ฅ Hospital Access Flow

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              PATIENT (Medical User)                  โ
โ                                                      โ
โ  Grants Hospital Access with:                       โ
โ  โข Hospital ID                                       โ
โ  โข Scope: [profile, records, bills, insurance]      โ
โ  โข Permissions: { read: true, upload: true }        โ
โ  โข Duration: 7 days                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โ POST /medical/access/grant
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              DATABASE: hospital_access               โ
โ                                                      โ
โ  โข Creates access record                            โ
โ  โข Sets expiry date                                  โ
โ  โข Creates audit log entry                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    HOSPITAL                          โ
โ                                                      โ
โ  1. Login to hospital dashboard                     โ
โ  2. View active patients (GET /hospital/patients)   โ
โ  3. Select patient                                   โ
โ  4. View details (GET /hospital/patient/:id)        โ
โ     โข System checks access permissions              โ
โ     โข Filters data based on scope                   โ
โ     โข Creates audit log entry                       โ
โ  5. Upload records (if permitted)                   โ
โ     โข POST /hospital/records/upload                 โ
โ  6. Create bills                                     โ
โ     โข POST /hospital/bills/create                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              AUDIT LOG (Immutable)                   โ
โ                                                      โ
โ  โข access_granted                                    โ
โ  โข data_viewed                                       โ
โ  โข data_uploaded                                     โ
โ  โข Timestamp                                         โ
โ  โข IP Address                                        โ
โ  โข Details (JSON)                                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐พ Farmer Module Flow (SECONDARY MODULE)

```
USER DASHBOARD
      โ
      โ Select "Farmer Services"
      โผ
โโโโโโโโโโโโโโโโโโโโโโโโ
โ Check Farmer         โ
โ Account Status       โ
โ GET /farmer/         โ
โ account/status       โ
โโโโโโโโโโโโโโโโโโโโโโโโ
      โ
      โโโโ EXISTS โโโโโ
      โ               โ
  NOT EXISTS         โ
      โ               โผ
      โผ         โโโโโโโโโโโโโโโโ
โโโโโโโโโโโโโโโโโโโโโโโโโ FARMER       โ
โ CREATE FARMER  โโ DASHBOARD    โ
โ    ACCOUNT           โโ              โ
โ                      โโโโโโโโโโโโโโโโโ
โ โข Land Details       โ      โ
โ โข Crop Types         โ      โ
โ โข Bank Account       โ      โผ
โ POST /farmer/        โโโโโโโโโโโโโโโโโ
โ  account/create      โโ Applications โ
โโโโโโโโโโโโโโโโโโโโโโโโโ โข Submit     โ
      โ               โโ โข Track      โ
      โ               โโโโโโโโโโโโโโโโโ
      โโโโโโโโโโโโโโโโโ
```

## ๐ Security Architecture

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  CLIENT REQUEST                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              AUTHENTICATION LAYER                    โ
โ                                                      โ
โ  1. Extract JWT from Authorization header           โ
โ  2. Verify token signature                          โ
โ  3. Check token expiration                          โ
โ  4. Decode user information                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              AUTHORIZATION LAYER                     โ
โ                                                      โ
โ  1. Check user role/type                            โ
โ  2. Verify route permissions                        โ
โ  3. Check resource ownership                        โ
โ  4. Validate access scope (for hospitals)           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                BUSINESS LOGIC                        โ
โ                                                      โ
โ  Execute requested operation                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  AUDIT LOGGING                       โ
โ                                                      โ
โ  Record all access events (immutable)               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ Database Schema Relationships

```
โโโโโโโโโโโโ          โโโโโโโโโโโโโโโโโโโ
โ  users   โโโ1โโโ1โโโโ medical_account โ
โโโโโโโโโโโโ          โโโโโโโโโโโโโโโโโโโ
     โ                        โ
     โ                        โ 1
     โ                        โ
     โ                        โ *
     โ                 โโโโโโโโโโโโโโโโ
     โ                 โhospital_     โ
     โ                 โ  access      โ
     โ                 โโโโโโโโโโโโโโโโ
     โ                        โ
     โ                        โ *
     โ                        โ
     โ                        โ 1
     โ                 โโโโโโโโโโโโโโโโ
     โ                 โ  hospitals   โ
     โ                 โโโโโโโโโโโโโโโโ
     โ
     โ 1
     โ
     โ *
โโโโโโโโโโโโโโโโ
โfarmer_accountโ
โโโโโโโโโโโโโโโโ
     โ 1
     โ
     โ *
โโโโโโโโโโโโโโโโ
โ  farmer_     โ
โ applications โ
โโโโโโโโโโโโโโโโ
     โ *
     โ
     โ 1
โโโโโโโโโโโโโโโโ
โ government_  โ
โ    users     โ
โโโโโโโโโโโโโโโโ
```

## ๐ฏ Data Privacy Model

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              USER'S MEDICAL DATA                     โ
โ                                                      โ
โ  Default State: PRIVATE                             โ
โ  Access: User Only                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โ User Action:
                         โ Grant Access
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ           GRANULAR ACCESS CONTROL                    โ
โ                                                      โ
โ  Scope Selection:                                    โ
โ    โ Profile    โ Records                           โ
โ    โ Bills      โ Insurance                         โ
โ                                                      โ
โ  Permissions:                                        โ
โ    Profile:  { read: true, upload: false }          โ
โ    Records:  { read: true, upload: true }           โ
โ                                                      โ
โ  Duration: 7 days (auto-expire)                     โ
โ                                                      โ
โ  Hospital: City General Hospital (#1)               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โ Access Created
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ           HOSPITAL CAN NOW ACCESS:                   โ
โ                                                      โ
โ  โ Profile Data (read only)                        โ
โ  โ Medical Records (read + upload)                 โ
โ  โ Bills (no access)                               โ
โ  โ Insurance (no access)                           โ
โ                                                      โ
โ  Valid Until: 7 days from now                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โ All actions logged
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              IMMUTABLE AUDIT TRAIL                   โ
โ                                                      โ
โ  2024-01-17 10:30 - access_granted                  โ
โ  2024-01-17 11:45 - data_viewed (profile)           โ
โ  2024-01-17 14:20 - data_uploaded (lab_report)      โ
โ  2024-01-18 09:15 - data_viewed (records)           โ
โ  2024-01-20 16:00 - access_revoked (user action)    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

**This architecture ensures:**
- โ Complete user control over data
- โ Granular permission management
- โ Time-bound access
- โ Complete transparency (audit logs)
- โ Immutable record keeping
- โ Privacy-first design
